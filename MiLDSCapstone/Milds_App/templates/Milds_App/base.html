<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>{% block title %}MiLDS{% endblock %}</title>
  <style>
    /* Layout */
    body {
      margin: 0;
      font-family: sans-serif;
      display: flex;
      height: 100vh;
    }
    nav {
      width: 220px;
      background: #2c3e50;
      color: #ecf0f1;
      padding: 1em;
      box-sizing: border-box;
    }
    nav h2 {
      margin-top: 0;
      font-size: 1.2em;
      border-bottom: 1px solid #7f8c8d;
      padding-bottom: .25em;
    }
    nav ul {
      list-style: none;
      padding-left: 0;
    }
    nav li {
      margin: .5em 0;
    }
    nav a {
      color: #ecf0f1;
      text-decoration: none;
    }
    nav a:hover {
      text-decoration: underline;
    }
    main {
      flex: 1;
      padding: 2em;
      overflow-y: auto;
    }
    .action-btn {
    background-color: #2c3e50;
    color: white;
  }

  .action-btn:hover {
    background-color: #732d91;
  }
    
  </style>
</head>
<script>
  // Django’s default CSRFTOKEN cookie name
  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== "") {
      document.cookie.split(";").forEach(cookie => {
        cookie = cookie.trim();
        if (cookie.startsWith(name + "=")) {
          cookieValue = decodeURIComponent(cookie.slice(name.length + 1));
        }
      });
    }
    return cookieValue;
  }
</script>

<body>

  <nav>
    <h2>Aircraft</h2>
    <ul>
      <li><a href="{% url 'list_aircraft' %}">List Aircraft</a></li>
      <li><a href="{% url 'create_aircraft' %}">Add Aircraft</a></li>
      <li><a href="" id="pull-aircraft" data-url="{% url 'api_get_aircraft' %}">Receive Data from Griffin</a></li>
      <li><a href="" id="push-aircraft" data-url="{% url 'api_push_aircraft' %}">Send Changes to Griffin</a></li>
    </ul>

    
    
    <pre id="aircraft-data"></pre>
    <script>
      const pullBtn = document.getElementById("pull-aircraft");
        pullBtn.addEventListener("click", async (e) => {
          e.preventDefault(); // Prevent default link behavior
          const url = document.getElementById("pull-aircraft").dataset.url;
          try {
            const res = await fetch(url);
            if (!res.ok) {
              console.error("Fetch failed:", await res.text());
              alert("Failed to pull aircraft.");
              return;
            }
            // wait for response to finish before reloading 
            await res.json();
            window.location.reload();
          } catch (err) {
            console.error(err);
            alert("Error pulling aircraft—check console.");
          }
        });
    </script>

  <script>
    const pushBtn = document.getElementById("push-aircraft");
    pushBtn.addEventListener("click", async () => {
      pushBtn.disabled = true;
      pushBtn.textContent = "Pushing…";
  
      const url = pushBtn.dataset.url;
      const csrftoken = getCookie("csrftoken");
  
      try {
        const res = await fetch(url, {
          method: "POST",
          credentials: "same-origin",                // include cookies
          headers: {
            "X-CSRFToken": csrftoken,                // Django’s CSRF header
            "Content-Type": "application/json",      // if you ever send a body
          },
        });
        if (!res.ok) {
          const err = await res.text();
          throw new Error(err || res.statusText);
        }
        const { updated } = await res.json();
        alert(`Successfully updated ${updated} record${updated !== 1 ? "s" : ""}.`);
      } catch (e) {
        console.error("Push failed:", e);
        alert("Push failed: " + e.message);
        pushBtn.disabled = false;
        pushBtn.textContent = "Push Aircraft";
      }
    });
  </script>
    
    

    <h2>Personnel</h2>
    <ul>
      <li><a href="{% url 'list_personnel' %}">List Personnel</a></li>
      <li><a href="{% url 'create_personnel' %}">Add Personnel</a></li>
      <li><a href="" id="pull-personnel" data-url="{% url 'api_get_personnel' %}">Pull Data from AMAP</a></li>
      <li><a href="" id="push-personnel" data-url="{% url 'api_push_personnel' %}">Send Changes to AMAP</a></li>
    </ul>
  
  <script>
    const pullPsn = document.getElementById("pull-personnel");
      pullPsn.addEventListener("click", async (e) => {
        e.preventDefault(); // Prevent default link behavior
        const url = document.getElementById("pull-personnel").dataset.url;
        try {
          const res = await fetch(url);
          if (!res.ok) {
            console.error("Fetch failed:", await res.text());
            alert("Failed to pull personnel.");
            return;
          }
          // wait to response to finish before reloading 
          await res.json();
          window.location.reload();
        } catch (err) {
          console.error(err);
          alert("Error pulling personnel—check console.");
        }
      });
  </script>
    <script>
      // Make sure getCookie(name) is defined above this!
    
      const pushPsn = document.getElementById("push-personnel");
      pushPsn.addEventListener("click", async () => {
        pushPsn.disabled = true;
        pushPsn.textContent = "Pushing…";
    
        const url = pushPsn.dataset.url;
        const csrftoken = getCookie("csrftoken");
    
        try {
          const res = await fetch(url, {
            method: "POST",
            credentials: "same-origin", 
            headers: {
              "X-CSRFToken": csrftoken,
              "Content-Type": "application/json",
            },
          });
          if (!res.ok) {
            const err = await res.text();
            throw new Error(err || res.statusText);
          }
          const { updated } = await res.json();
          alert(`Successfully updated ${updated} record${updated !== 1 ? "s" : ""}.`);
        } catch (e) {
          console.error("Push failed:", e);
          alert("Push failed: " + e.message);
          pushPsn.disabled = false;
          pushPsn.textContent = "Push Personnel";
        }
      });
    </script>
  </nav>
  
  

  <main>
    {% block content %}
    <!-- Page‐specific content goes here -->
    {% endblock %}

  </main>

</body>
</html>
